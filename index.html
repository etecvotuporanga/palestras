<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscrições - Semana Acadêmica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>

<style>
    body { font-family: 'Inter', sans-serif; transition: background-color 0.5s ease, color 0.5s ease; }
    .loader {
        border: 4px solid #f3f3f3;
        border-radius: 50%;
        border-top: 4px solid #3498db;
        width: 32px;
        height: 32px;
        animation: spin 1s linear infinite;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    
    .tab-btn, .periodo-tab-btn {
        transition: all 0.3s ease;
    }
    .tab-btn.active, .periodo-tab-btn.active {
        border-color: #3b82f6;
        background-color: #3b82f6;
        color: white;
    }
    
    /* Cores e transições do modo noturno */
    .dark-mode {
    background-color: #1a202c;
    color: #e2e8f0; 
    transition: background-color 0.5s ease, color 0.5s ease;
}

    .dark-mode .bg-gray-100 {
        background-color: #1a202c; /* Fundo principal escuro */
        transition: background-color 0.5s ease;
    }
    

    .dark-mode .bg-white,
    .dark-mode .bg-gray-50,
    .dark-mode input,
    .dark-mode select {
        background-color: #2d3748; /* Fundo dos cards e campos de input */
        color: #e2e8f0;
        border-color: #4a5568;
        transition: background-color 0.5s ease, color 0.5s ease, border-color 0.5s ease;
    }

    .dark-mode .text-gray-800 {
        color: #e2e8f0;
        transition: color 0.5s ease;
    }

    .dark-mode .text-gray-900 {
        color: #f7fafc;
        transition: color 0.5s ease;
    }

    .dark-mode .text-gray-500 {
        color: #a0aec0;
        transition: color 0.5s ease;
    }
    
    .dark-mode .text-gray-600 {
        color: #cbd5e0;
        transition: color 0.5s ease;
    }

    .dark-mode .border-gray-200 {
        border-color: #4a5568;
        transition: border-color 0.5s ease;
    }

    .dark-mode .shadow-md {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -1px rgba(0, 0, 0, 0.12);
        transition: box-shadow 0.5s ease;
    }
	.dark-mode .text-light {
    color: #cbd5e0; 
    transition: color 0.5s ease;
}
	
</style>
</head>
<body class="text-gray-800">
    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="flex flex-col sm:flex-row justify-between items-center mb-8 bg-white p-6 rounded-xl shadow-md">
            <h1 class="text-3xl font-bold text-gray-900 mb-4 sm:mb-0">Inscrições - Semana Acadêmica</h1>
            <div id="auth-container" class="flex items-center space-x-4">
                <div id="user-info" class="hidden text-right">
                    <p class="font-semibold text-gray-700" id="user-name"></p>
                    <p class="text-sm text-gray-500" id="user-email"></p>
                </div>
                <button id="delete-my-registrations-button" class="hidden bg-red-600 text-white font-semibold px-6 py-2 rounded-lg hover:bg-red-700 transition duration-300 shadow-sm">
                    Excluir Minhas Inscrições
                </button>
                <button id="auth-button" class="bg-blue-600 text-white font-semibold px-6 py-2 rounded-lg hover:bg-blue-700 transition duration-300 shadow-sm">
                    Login com Google
                </button>
            </div>
        </header>

        <div class="mb-6 bg-white p-4 rounded-xl shadow-md">
            <h2 class="text-lg font-semibold mb-3 text-gray-800">Selecione seu período:</h2>
            <div class="flex flex-wrap gap-3">
                <button id="filter-integral" class="periodo-filter-btn bg-blue-100 text-blue-800 font-semibold py-2 px-5 rounded-lg border-2 border-blue-300">
                    Período Integral
                </button>
                <button id="filter-noturno" class="periodo-filter-btn bg-indigo-100 text-indigo-800 font-semibold py-2 px-5 rounded-lg border-2 border-indigo-300">
                    Período Noturno
                </button>
            </div>
        </div>
        
        <div id="main-content" class="hidden">
        <div id="tabs-container" class="mb-6 flex flex-wrap gap-2 border-b border-gray-200 pb-3 text-light">
    <button data-day="1" class="tab-btn active font-semibold py-2 px-5 rounded-lg border-2 border-transparent">Feira de Profissões(08/09)</button>
    <button data-day="2" class="tab-btn font-semibold py-2 px-5 rounded-lg border-2 border-transparent">Palestras (09/09)</button>
    <button data-day="3" class="tab-btn font-semibold py-2 px-5 rounded-lg border-2 border-transparent noturno-only hidden">Oficinas (10/09)</button>
    <button data-day="4" class="tab-btn font-semibold py-2 px-5 rounded-lg border-2 border-transparent">Palestras (11/09)</button>
    <button data-day="5" class="tab-btn font-semibold py-2 px-5 rounded-lg border-2 border-transparent integral-only hidden">Oficinas (12/09)</button>
</div>

            <main id="lectures-by-day-container">
                <div class="flex justify-center items-center h-40">
                    <div class="loader"></div>
                    <p class="ml-4 text-gray-600">Carregando palestras...</p>
                </div>
            </main>
        </div>

        <footer class="text-center mt-12 text-gray-500">
            <p>&copy; 2025 Semana Acadêmica. Todos os direitos reservados.</p>
        </footer>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, where, getDocs, onSnapshot, serverTimestamp, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyD0rC3RYKVEutV4lg1UMehtavZmATEE3gk",
            authDomain: "palestras-ac51e.firebaseapp.com",
            projectId:  "palestras-ac51e",
            storageBucket: "palestras-ac51e.appspot.com",
            messagingSenderId: "961901054844",
            appId: "1:961901054844:web:15118d30a8d2fbdac032f9"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();
        const registrationsCollection = collection(db, `artifacts/default-lecture-app/public/data/registrations`);

        // Array de palestras reorganizado
        const lecturesByDay = [
            {
                day: 1,
                lectures: [
                    { id: 'medicina-dia1', title: 'Medicina', periodo: 'Integral', description: '<strong>Horário:</strong> 10:30<br><strong>Local:</strong> Sala A<br><strong>Palestrante:</strong> Wagner Moneda Telini' },
                    { id: 'psicologia-dia1', title: 'Psicologia', periodo: 'Integral', description: '<strong>Horário:</strong> 10:30<br><strong>Local:</strong> Sala B<br><strong>Palestrante:</strong> Carol Hamparian' },
                    { id: 'Direito-dia1', title: 'Direito', periodo: 'Integral', description: '<strong>Horário:</strong> 10:30<br><strong>Local:</strong> Sala C<br><strong>Palestrante:</strong> Érica Molina Rubim' },
                    { id: 'Com-social-dia1', title: 'Comunicação social', periodo: 'Integral', description: '<strong>Horário:</strong> 10:30<br><strong>Local:</strong> Sala 1<br><strong>Palestrante:</strong> Vanessa de Castro e Letícia Ishikama da Silva' },
                    { id: 'Agronomia-dia1', title: 'Agronomia', periodo: 'Integral', description: '<strong>Horário:</strong> 10:30<br><strong>Local:</strong> Sala 2<br><strong>Palestrante:</strong> Mariane Barbará' },
                    { id: 'Eng-civil-dia1', title: 'Engenharia civil', periodo: 'Integral', description: '<strong>Horário:</strong> 10:30<br><strong>Local:</strong> Sala 3<br><strong>Palestrante:</strong> Angélica Paiva Ramos' },
                    { id: 'Psicologia-noturno-dia1', title: 'Psicologia', periodo: 'Noturno', description: '<strong>Horário:</strong> 19:30<br><strong>Local:</strong> Sala A<br><strong>Palestrante:</strong> Marina Castilho de Oliveira e Natália Martinez Vieira' },
                    { id: 'Direito-noturno-dia1', title: 'Direito', periodo: 'Noturno', description: '<strong>Horário:</strong> 19:30<br><strong>Local:</strong> Sala 1<br><strong>Palestrante:</strong> Marcelo Leal da Silva' },
                    { id: 'Agronomia-noturno-dia1', title: 'Agronomia', periodo: 'Noturno', description: '<strong>Horário:</strong> 19:30<br><strong>Local:</strong> Sala 2<br><strong>Palestrante:</strong> Mariane Barbará' },
                    { id: 'Eng-civil-noturno-dia1', title: 'Engenharia civil', periodo: 'Noturno', description: '<strong>Horário:</strong> 19:30<br><strong>Local:</strong> Sala 3<br><strong>Palestrante:</strong> César Fernandes' },
                ]
            },
            {
                day: 2,
                lectures: [
                    { id: 'motivacional-dia2', title: 'A estrada até aqui', periodo: 'Integral', description: '<strong>Horário:</strong> 10:30<br><strong>Local:</strong> Sala A<br><strong>Palestrante:</strong> Bruno Scriboni' },
                    { id: 'comunicaçao-dia2', title: 'Entre likes, reuniões e bastidores: a vida real de quem trabalha com comunicação', periodo: 'Integral', description: '<strong>Horário:</strong> 10:30<br><strong>Local:</strong> Sala B<br><strong>Palestrante:</strong> Wender Rodrigues' },
                    { id: 'inf-e-com-dia2', title: 'Smartcities e seus desafios', periodo: 'Integral', description: '<strong>Horário:</strong> 10:30<br><strong>Local:</strong> Sala C<br><strong>Palestrante:</strong> Claudio Juny Figueiredo' },
                    { id: 'saude-dia2', title: 'Doenças Periodontais', periodo: 'Integral', description: '<strong>Horário:</strong> 10:30<br><strong>Local:</strong> Sala 1<br><strong>Palestrante:</strong> Jaqueline Leopoldo' },
                    { id: 'seguranca-dia2', title: 'Primeiros Socorros - Lei Lucas', periodo: 'Integral', description: '<strong>Horário:</strong> 10:30<br><strong>Local:</strong> Sala 2<br><strong>Palestrante:</strong> Major Brito' },
					{ id: 'inf-e-com-2-dia2', title: 'Segurança Digital: Riscos, Prevenção e Análise de Casos', periodo: 'Integral', description: '<strong>Horário:</strong> 10:30<br><strong>Local:</strong> Sala 3<br><strong>Palestrantes:</strong> Allan Victor Nunes Candido, Maria Julia Sedoguchi Barbosa,Yasmim Bispo Alves, Suzana Florinda Mavuba da Silva' },
                    { id: 'gestao-noturno-dia2', title: 'Falhar faz parte! Como aprender com os erros e criar uma identidade empreendedora', periodo: 'Noturno', description: '<strong>Horário:</strong> 19:30<br><strong>Local:</strong> Sala A<br><strong>Palestrante:</strong> Denise Martin' },
                    { id: 'Inf-e-com-noturno-dia2', title: 'Arquiteto de software', periodo: 'Noturno', description: '<strong>Horário:</strong> 19:30<br><strong>Local:</strong> Sala 1<br><strong>Palestrante:</strong> Raul Mariano' },
                    { id: 'Motivacional-noturno-dia2', title: 'Investimentos inteligentes', periodo: 'Noturno', description: '<strong>Horário:</strong> 19:30<br><strong>Local:</strong> Sala 2<br><strong>Palestrante:</strong> Claudio Juny Figueiredo' },
                    { id: 'comunicaçao-noturno-dia2', title: 'Entre likes, reuniões e bastidores: a vida real de quem trabalha com comunicação', periodo: 'Noturno', description: '<strong>Horário:</strong> 19:30<br><strong>Local:</strong> Sala 3<br><strong>Palestrante:</strong> Wender Rodrigues' },
                ]
            },
            {
                day: 3,
                lectures: [
                    { id: 'Oratoria-dia3', title: 'Oratória e Apresentação', periodo: 'Noturno', description: '<strong>Horário:</strong> 19:30<br><strong>Local:</strong> Sala A<br><strong>Palestrante:</strong> Lorena ' },
                    { id: 'E-commerce-dia3', title: 'E-commerce', periodo: 'Noturno', description: '<strong>Horário:</strong> 19:30<br><strong>Local:</strong> Sala 1<br><strong>Palestrante:</strong> Nahany ' },
					{ id: 'maquiagem-dia3', title: 'Expressão e Estilo: Aprenda Maquiagem na Prática', periodo: 'Noturno', description: '<strong>Horário:</strong> 19:30<br><strong>Local:</strong> Sala 2<br><strong>Palestrante:</strong> Emanuelle ' },
					{ id: 'GD-dia3', title: 'Game Designer', periodo: 'Noturno', description: '<strong>Horário:</strong> 13:20<br><strong>Local:</strong> Sala A<br><strong>Palestrantes:</strong> Daniel, Dherick e Guilherme Mainardi' },
                ]
            },
            {
                day: 4,
                lectures: [
                    { id: 'motivacional-dia4', title: 'Amor ou Medo - A decisão que muda sua vida', periodo: 'Integral', description: '<strong>Horário:</strong> 10:30<br><strong>Local:</strong> Sala A<br><strong>Palestrante:</strong> Grazi Cavenaghi' },
                    { id: 'gestao-dia4', title: 'Reduzir, Reulitizar, Reciclar: A Prática da Gestão de Resíduos em Votuporanga', periodo: 'Integral', description: '<strong>Horário:</strong> 10:30<br><strong>Local:</strong> Sala B<br><strong>Palestrante:</strong> Vitor Costa' },
                    { id: 'inf-e-com-dia4', title: 'Gestão e IA: Como Usar os "Superpoderes" da Inteligência Artificial para Criar o Futuro (e não ser substituído por ele).', periodo: 'Integral', description: '<strong>Horário:</strong> 10:30<br><strong>Local:</strong> Sala C<br><strong>Palestrante:</strong> Gean Santos' },
                    { id: 'saude-dia4', title: 'Mente blindada: escolhas que constroem, atitudes que transformam', periodo: 'Integral', description: '<strong>Horário:</strong> 10:30<br><strong>Local:</strong> Sala 1<br><strong>Palestrante:</strong> Viviani Buzzo' },
                    { id: 'inclusao-dia4', title: 'Autismo: conhecer para respeitar e incluir', periodo: 'Integral', description: '<strong>Horário:</strong> 10:30<br><strong>Local:</strong> Sala 2<br><strong>Palestrante:</strong> Ana Claudia Picolini' },
					{ id: 'direito-dia4', title: 'Direito e Administração: Decidindo hoje o sucesso de amanhã', periodo: 'Integral', description: '<strong>Horário:</strong> 10:30<br><strong>Local:</strong> Sala 3<br><strong>Palestrante:</strong> Luciano Silva' },
                    { id: 'gestao-noturno-dia4', title: 'Como administrar seu próprio negócio', periodo: 'Noturno', description: '<strong>Horário:</strong> 19:30<br><strong>Local:</strong> Sala A<br><strong>Palestrante:</strong> Leandro Poçam' },
                    { id: 'Inf-e-com-noturno-dia4', title: 'Produção de mídias digitais', periodo: 'Noturno', description: '<strong>Horário:</strong> 19:30<br><strong>Local:</strong> Sala 1<br><strong>Palestrante:</strong> Chritopher Bueno' },
                    { id: 'seguranca-noturno-dia4', title: 'Primeiros Socorros - Lei Lucas', periodo: 'Noturno', description: '<strong>Horário:</strong> 19:30<br><strong>Local:</strong> Sala 2<br><strong>Palestrante:</strong>Major Brito' },
                    { id: 'motivacional-noturno-dia4', title: 'Amor ou Medo - A decisão que muda sua vida', periodo: 'Noturno', description: '<strong>Horário:</strong> 19:30<br><strong>Local:</strong> Sala 3<br><strong>Palestrante:</strong> Grazi Cavenaghi' },
                ]
            },
            {
                day: 5,
                lectures: [
                    { id: 'GD-dia5', title: 'Game Designer', periodo: 'Integral', description: '<strong>Horário:</strong> 13:20<br><strong>Local:</strong> Sala A<br><strong>Palestrantes:</strong> Daniel, Dherick e Guilherme Mainardi' },
					{ id: 'do-re-dia5', title: 'Dó-Ré-Ministração', periodo: 'Integral', description: '<strong>Horário:</strong> 13:20<br><strong>Local:</strong> Sala B<br><strong>Palestrantes:</strong> Filipe e José Augusto' },
                    { id: 'Autoimagem-dia5', title: 'Autoimagem no ambiente de trabalho', periodo: 'Integral', description: '<strong>Horário:</strong> 13:20<br><strong>Local:</strong> Sala C<br><strong>Palestrante:</strong>Anne Marrye, Maria Eduarda' },
					{ id: 'md-dia5', title: 'Feed Criativo-Marketing Digital ', periodo: 'Integral', description: '<strong>Horário:</strong> 13:20<br><strong>Local:</strong> Sala 1<br><strong>Palestrantes:</strong> Gabriel e Nathalia' },
					{ id: 'yt-dia5', title: 'Da criação à monetização: domine o YouTube na prática ', periodo: 'Integral', description: '<strong>Horário:</strong> 13:20<br><strong>Local:</strong> Sala 2<br><strong>Palestrantes:</strong> Luiz Felipe Oliveira Santos' },
					{ id: 'criptomoedas-dia5', title: 'Do zero ao milhão com criptomoedas', periodo: 'Integral', description: '<strong>Horário:</strong> 13:20<br><strong>Local:</strong> Sala 3<br><strong>Palestrantes:</strong> Raphael e Kaiky' },
                ]
            }
        ];
        
        const TOTAL_SPOTS = 40;
        let allRegistrations = {};
        let selectedPeriodoFilter = null; // Filtro padrão, agora nulo
        let isFirstLoad = true;

        const authButton = document.getElementById('auth-button');
        const userInfoDiv = document.getElementById('user-info');
        const userNameP = document.getElementById('user-name');
        const userEmailP = document.getElementById('user-email');
        const lecturesContainer = document.getElementById('lectures-by-day-container');
        const deleteMyRegistrationsButton = document.getElementById('delete-my-registrations-button');
        const tabsContainer = document.getElementById('tabs-container');
        const filterIntegralBtn = document.getElementById('filter-integral');
        const filterNoturnoBtn = document.getElementById('filter-noturno');
        const mainContent = document.getElementById('main-content');

        onAuthStateChanged(auth, user => updateUIForAuthState(user));

        function updateUIForAuthState(user) {
            if (user) {
                userNameP.textContent = user.displayName || 'Usuário';
                userEmailP.textContent = user.email || '';
                userInfoDiv.classList.remove('hidden');
                deleteMyRegistrationsButton.classList.remove('hidden');
                authButton.textContent = 'Sair';
                authButton.onclick = () => signOut(auth);
                document.querySelectorAll('.student-email-input').forEach(i => i.value = user.email || '');
                document.querySelectorAll('.student-name-input').forEach(i => i.value = user.displayName || '');
            } else {
                userInfoDiv.classList.add('hidden');
                deleteMyRegistrationsButton.classList.add('hidden');
                authButton.textContent = 'Login com Google';
                authButton.onclick = () => signInWithPopup(auth, provider);
                document.querySelectorAll('.student-email-input').forEach(i => i.value = '');
                document.querySelectorAll('.student-name-input').forEach(i => i.value = '');
            }
        }

        function renderLectures() {
            lecturesContainer.innerHTML = '';
            lecturesByDay.forEach(dayData => {
                // Verificar se o dia deve ser exibido com base no filtro selecionado
                if (selectedPeriodoFilter === 'Integral' && dayData.day === 3) {
                    return; // Não renderizar a aba do dia 10 (noturno) para o integral
                }
                
                if (selectedPeriodoFilter === 'Noturno' && dayData.day === 5) {
                    return; // Não renderizar a aba do dia 12 (integral) para o noturno
                }

                const dayContainer = document.createElement('div');
                dayContainer.id = `day-content-${dayData.day}`;
                dayContainer.className = 'space-y-6';
                if (dayData.day !== 1) { dayContainer.classList.add('hidden'); }

                if (dayData.lectures.length === 0) {
                    dayContainer.innerHTML = `<div class="bg-white p-6 rounded-xl shadow-md text-center text-gray-500">Nenhuma palestra programada para este dia.</div>`;
                } else {
                    // Filtrar palestras pelo período selecionado
                    const filteredLectures = dayData.lectures.filter(l => l.periodo === selectedPeriodoFilter);
                    
                    if (filteredLectures.length === 0) {
                        dayContainer.innerHTML = `<div class="bg-white p-6 rounded-xl shadow-md text-center text-gray-500">Nenhuma palestra do período ${selectedPeriodoFilter.toLowerCase()} programada para este dia.</div>`;
                        lecturesContainer.appendChild(dayContainer);
                        return;
                    }
                    
                    dayContainer.innerHTML = `<div class="periodo-tabs-container mb-4 flex flex-wrap items-center gap-2" data-day="${dayData.day}">
					<h5 class="text-lg font-bold text-light">Palestras do Período</h5>
					<span class="text-sm font-bold ${selectedPeriodoFilter === 'Integral' ? 'text-blue-700' : 'text-indigo-500'}">${selectedPeriodoFilter}</span>
					</div>`;
                    filteredLectures.forEach(lecture => {
                        const uniqueIdPrefix = `dia${dayData.day}-${lecture.id}`;
                        const card = document.createElement('div');
                        card.className = 'lecture-card bg-white p-6 rounded-xl shadow-md';
                        card.id = `card-${uniqueIdPrefix}`;
                        card.dataset.periodo = lecture.periodo;

                        card.innerHTML = `
                            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                                <div>
                                    <div class="flex items-center gap-3">
                                        <h2 class="text-xl font-bold text-gray-800">${lecture.title}</h2>
                                        <span class="text-xs font-bold py-1 px-2.5 rounded-full ${lecture.periodo === 'Integral' ? 'bg-blue-100 text-blue-800' : 'bg-indigo-100 text-indigo-800'}">${lecture.periodo}</span>
                                    </div>
                                    <div class="mt-2">
                                        <button type="button" class="text-sm text-blue-600 hover:underline focus:outline-none toggle-description-btn" data-target-id="desc-${uniqueIdPrefix}">Ver Detalhes</button>
                                        <div id="desc-${uniqueIdPrefix}" class="hidden mt-2 text-sm text-gray-600 pr-4"><div class="p-3 bg-gray-50 rounded-lg border">${lecture.description}</div></div>
                                    </div>
                                    <p class="text-green-600 font-semibold mt-2">Vagas Preenchidas: <span id="count-${uniqueIdPrefix}">0</span> / ${TOTAL_SPOTS}</p>
                                </div>
                                <div id="status-${uniqueIdPrefix}" class="mt-4 md:mt-0 px-4 py-2 rounded-full text-sm font-medium bg-gray-200 text-gray-700">Aguardando...</div>
                            </div>
                            <div class="mt-4 border-t pt-4">
                                <form id="form-${uniqueIdPrefix}" data-lecture-id="${lecture.id}" data-day="${dayData.day}" class="space-y-4">
                                    <p class="text-sm font-medium text-gray-600">Inscreva-se agora:</p>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div><input type="text" id="name-${uniqueIdPrefix}" required placeholder="Seu nome completo" class="student-name-input w-full px-4 py-2 border rounded-lg"></div>
                                        <div><input type="email" id="email-${uniqueIdPrefix}" required placeholder="Seu melhor e-mail" class="student-email-input w-full px-4 py-2 border rounded-lg"></div>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div><select id="serie-${uniqueIdPrefix}" required class="w-full px-4 py-2 border rounded-lg bg-white text-gray-700"><option value="" disabled selected>Sua série</option><option value="1">1ª Série</option><option value="2">2ª Série</option><option value="3">3ª Série</option></select></div>
                                        <div><select id="curso-${uniqueIdPrefix}" required class="w-full px-4 py-2 border rounded-lg bg-white text-gray-700"><option value="" disabled selected>Seu curso</option><option value="Administração de Empresas">Administração de Empresas</option><option value="Informática para Internet">Informática para Internet</option><option value="Desenvolvimento de Sistemas">Desenvolvimento de Sistemas</option><option value="Recursos Humanos">Recursos Humanos</option></select></div>
                                        <div><select id="periodo-${uniqueIdPrefix}" required class="w-full px-4 py-2 border rounded-lg bg-white text-gray-700"><option value="" disabled selected>Seu período</option><option value="Integral">Integral</option><option value="Noturno">Noturno</option></select></div>
                                    </div>
                                    <div class="flex flex-col sm:flex-row gap-3">
                                        <button type="submit" class="w-full sm:w-auto bg-green-600 text-white font-semibold px-6 py-2 rounded-lg">Confirmar Inscrição</button>
                                        <button type="button" class="view-registrations-btn w-full sm:w-auto bg-blue-500 text-white px-6 py-2 rounded-lg" data-unique-id="${uniqueIdPrefix}">Ver Inscritos</button>
                                        <button type="button" class="download-pdf-btn w-full sm:w-auto bg-gray-600 text-white font-semibold px-6 py-2 rounded-lg" data-unique-id="${uniqueIdPrefix}">Baixar PDF</button>
                                    </div>
                                </form>
                                <div id="message-${uniqueIdPrefix}" class="mt-3 text-sm font-medium"></div>
                                <div id="registrations-list-${uniqueIdPrefix}" class="hidden mt-4 p-4 bg-gray-50 rounded-lg border max-h-60 overflow-y-auto">
                                    <h4 class="font-bold mb-2 text-gray-800">Inscritos:</h4>
                                    <ul id="list-ul-${uniqueIdPrefix}" class="list-disc list-inside text-gray-700 space-y-1"></ul>
                                </div>
                            </div>`;
                        dayContainer.appendChild(card);
                    });
                }
                lecturesContainer.appendChild(dayContainer);
            });
            updateUIForAuthState(auth.currentUser);
        }

        function handleTabClick(event) {
            if (!event.target.matches('.tab-btn')) return;
            const selectedDay = event.target.dataset.day;
            tabsContainer.querySelectorAll('.tab-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.day === selectedDay));
            lecturesContainer.querySelectorAll('[id^="day-content-"]').forEach(content => content.classList.toggle('hidden', content.id !== `day-content-${selectedDay}`));
        }

    function handlePeriodoFilterClick(event) {
    const isIntegral = event.target.id === 'filter-integral';
    selectedPeriodoFilter = isIntegral ? 'Integral' : 'Noturno';
    
    // Adiciona ou remove a classe 'dark-mode' do corpo do documento
    if (isIntegral) {
        document.body.classList.remove('dark-mode');
    } else {
        document.body.classList.add('dark-mode');
    }

    // Mostrar o conteúdo principal ao selecionar um período
    mainContent.classList.remove('hidden');

    // Atualizar UI dos botões de filtro
    filterIntegralBtn.classList.toggle('active', isIntegral);
    filterNoturnoBtn.classList.toggle('active', !isIntegral);
    
    if (isIntegral) {
        filterIntegralBtn.classList.add('bg-blue-600', 'text-white');
        filterIntegralBtn.classList.remove('bg-blue-100', 'text-blue-800', 'border-blue-300');
        filterNoturnoBtn.classList.add('bg-indigo-100', 'text-indigo-800', 'border-indigo-300');
        filterNoturnoBtn.classList.remove('bg-indigo-600', 'text-white');
    } else {
        filterNoturnoBtn.classList.add('bg-indigo-600', 'text-white');
        filterNoturnoBtn.classList.remove('bg-indigo-100', 'text-indigo-800', 'border-indigo-300');
        filterIntegralBtn.classList.add('bg-blue-100', 'text-blue-800', 'border-blue-300');
        filterIntegralBtn.classList.remove('bg-blue-600', 'text-white');
    }
    
    // Atualizar abas de dias
    document.querySelectorAll('.integral-only').forEach(el => {
        el.classList.toggle('hidden', !isIntegral);
    });
    document.querySelectorAll('.noturno-only').forEach(el => {
        el.classList.toggle('hidden', isIntegral);
    });
    
    // Se a aba atual não estiver disponível no filtro selecionado, mudar para a primeira aba disponível
    const firstTabForPeriod = tabsContainer.querySelector(`.tab-btn:not(.hidden)`);
    if (firstTabForPeriod) {
        firstTabForPeriod.click();
    }
    
    // Renderizar as palestras com o novo filtro
    renderLectures();
    listenToRegistrations();
            
        }

        async function handleRegistration(event) {
            event.preventDefault();
            const user = auth.currentUser;
            if (!user) { displayMessage(event.target.id.replace('form-',''), 'Faça login com Google antes.', 'red'); return; }
            const { lectureId, day } = event.target.dataset;
            const uniqueIdPrefix = `dia${day}-${lectureId}`;
            const name = document.getElementById(`name-${uniqueIdPrefix}`).value.trim();
            const email = document.getElementById(`email-${uniqueIdPrefix}`).value.trim().toLowerCase();
            const serie = document.getElementById(`serie-${uniqueIdPrefix}`).value;
            const curso = document.getElementById(`curso-${uniqueIdPrefix}`).value;
            const periodo = document.getElementById(`periodo-${uniqueIdPrefix}`).value;
            const button = event.target.querySelector('button[type="submit"]');
            const palestraInfo = lecturesByDay.find(d => d.day === parseInt(day))?.lectures.find(l => l.id === lectureId);
            if (palestraInfo && palestraInfo.periodo !== periodo) {
                displayMessage(uniqueIdPrefix, `Inscrição não permitida. Seu período (${periodo}) é diferente do período da palestra (${palestraInfo.periodo}).`, 'red');
                return;
            }
            if (!name || !email || !serie || !curso || !periodo) {
                displayMessage(uniqueIdPrefix, 'Preencha todos os campos para se inscrever.', 'red');
                return;
            }
            button.disabled = true; button.textContent = 'Processando...';
            try {
                const q = query(registrationsCollection, where("studentEmail", "==", email), where("day", "==", parseInt(day)));
                const snapshot = await getDocs(q);
                if (!snapshot.empty) {
                    displayMessage(uniqueIdPrefix, 'Você já está inscrito em uma atividade para este dia.', 'orange');
                    throw "duplicado";
                }
                await addDoc(registrationsCollection, { lectureId, day: parseInt(day), studentName: name, studentEmail: email, serie, curso, periodo, registeredAt: serverTimestamp(), userId: user.uid });
                displayMessage(uniqueIdPrefix, 'Inscrição realizada com sucesso!', 'green');
                event.target.reset();
                updateUIForAuthState(auth.currentUser);
            } catch (err) {
                if (err !== "duplicado") displayMessage(uniqueIdPrefix, 'Erro ao registrar. Tente novamente.', 'red');
            } finally {
                button.disabled = false; button.textContent = 'Confirmar Inscrição';
            }
        }

        async function handleDeleteMyRegistrations() {
            const user = auth.currentUser;
            if (!user || !user.email) { alert("Você precisa estar logado para excluir suas inscrições."); return; }
            if (!confirm("Tem certeza que deseja excluir TODAS as suas inscrições em todos os dias? Esta ação não pode ser desfeita.")) { return; }
            this.disabled = true; this.textContent = "Excluindo...";
            try {
                const q = query(registrationsCollection, where("studentEmail", "==", user.email));
                const querySnapshot = await getDocs(q);
                if (querySnapshot.empty) { alert("Nenhuma inscrição encontrada para o seu e-mail."); return; }
                const deletePromises = querySnapshot.docs.map(docSnapshot => deleteDoc(doc(db, `artifacts/default-lecture-app/public/data/registrations`, docSnapshot.id)));
                await Promise.all(deletePromises);
                alert(`Sucesso! ${deletePromises.length} inscrição(ões) foram excluídas.`);
            } catch (error) {
                console.error("Erro ao excluir inscrições:", error);
                alert("Ocorreu um erro ao tentar excluir suas inscrições. Tente novamente.");
            } finally {
                this.disabled = false; this.textContent = "Excluir Minhas Inscrições";
            }
        }

        function displayMessage(uniqueIdPrefix, text, color) {
            const el = document.getElementById(`message-${uniqueIdPrefix}`);
            const colors = { red: 'text-red-600', green: 'text-green-600', orange: 'text-orange-500' };
            el.textContent = text;
            el.className = `mt-3 text-sm font-medium ${colors[color] || 'text-gray-600'}`;
            setTimeout(() => { el.textContent = ''; }, 5000);
        }

        function listenToRegistrations() {
            onSnapshot(registrationsCollection, snapshot => {
                const counts = {}; const registrations = {};
                lecturesByDay.forEach(dayData => dayData.lectures.forEach(l => {
                    const uniqueIdPrefix = `dia${dayData.day}-${l.id}`;
                    counts[uniqueIdPrefix] = 0;
                    registrations[uniqueIdPrefix] = [];
                }));

                snapshot.docs.forEach(doc => {
                    const data = doc.data();
                    const uniqueIdPrefix = `dia${data.day}-${data.lectureId}`;
                    if (counts.hasOwnProperty(uniqueIdPrefix)) {
                        counts[uniqueIdPrefix]++;
                        registrations[uniqueIdPrefix].push({ name: data.studentName, serie: data.serie, curso: data.curso, periodo: data.periodo });
                    }
                });
                
                allRegistrations = registrations;

                lecturesByDay.forEach(dayData => dayData.lectures.forEach(l => {
                    const uniqueIdPrefix = `dia${dayData.day}-${l.id}`;
                    const countEl = document.getElementById(`count-${uniqueIdPrefix}`);
                    if (countEl) {
                        countEl.textContent = counts[uniqueIdPrefix];
                        const statusEl = document.getElementById(`status-${uniqueIdPrefix}`);
                        const form = document.getElementById(`form-${uniqueIdPrefix}`);
                        const button = form.querySelector('button[type="submit"]');
                        if (counts[uniqueIdPrefix] >= TOTAL_SPOTS) {
                            statusEl.textContent = 'Vagas Esgotadas'; statusEl.className = 'mt-4 md:mt-0 px-4 py-2 rounded-full text-sm font-medium bg-red-200 text-red-800';
                            button.disabled = true; button.className = 'w-full sm:w-auto bg-gray-400 text-white font-semibold px-6 py-2 rounded-lg cursor-not-allowed';
                        } else {
                            statusEl.textContent = 'Vagas Disponíveis'; statusEl.className = 'mt-4 md:mt-0 px-4 py-2 rounded-full text-sm font-medium bg-green-200 text-green-800';
                            button.disabled = false; button.className = 'w-full sm:w-auto bg-green-600 text-white font-semibold px-6 py-2 rounded-lg';
                        }
                    }
                }));
            });
        }

        function setupEventListeners() {
            tabsContainer.addEventListener('click', handleTabClick);
            filterIntegralBtn.addEventListener('click', handlePeriodoFilterClick);
            filterNoturnoBtn.addEventListener('click', handlePeriodoFilterClick);
            deleteMyRegistrationsButton.addEventListener('click', handleDeleteMyRegistrations);
            authButton.addEventListener('click', () => auth.currentUser ? signOut(auth) : signInWithPopup(auth, provider));
            document.addEventListener('click', event => {
                if (event.target.matches('.toggle-description-btn')) {
                    const target = document.getElementById(event.target.dataset.targetId);
                    target.classList.toggle('hidden');
                    event.target.textContent = target.classList.contains('hidden') ? 'Ver Detalhes' : 'Ocultar Detalhes';
                }
                if (event.target.matches('.view-registrations-btn')) {
                    const uniqueId = event.target.dataset.uniqueId;
                    const listEl = document.getElementById(`registrations-list-${uniqueId}`);
                    const ulEl = document.getElementById(`list-ul-${uniqueId}`);
                    ulEl.innerHTML = '';
                    if (allRegistrations[uniqueId] && allRegistrations[uniqueId].length > 0) {
                        allRegistrations[uniqueId].forEach(reg => {
                            const li = document.createElement('li');
                            li.textContent = `${reg.name} - ${reg.serie}ª Série - ${reg.curso} (${reg.periodo})`;
                            ulEl.appendChild(li);
                        });
                    } else {
                        ulEl.innerHTML = '<li class="text-gray-500">Nenhum inscrito ainda.</li>';
                    }
                    listEl.classList.toggle('hidden');
                }
                if (event.target.matches('.download-pdf-btn')) {
                    const uniqueId = event.target.dataset.uniqueId;
                    const [day, lectureId] = uniqueId.replace('dia', '').split('-');
                    const lecture = lecturesByDay.find(d => d.day === parseInt(day))?.lectures.find(l => l.id === lectureId);
                    if (!lecture) return;
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    doc.setFontSize(20); doc.text(`Lista de Inscritos - ${lecture.title}`, 14, 22);
                    doc.setFontSize(12); doc.setTextColor(100); doc.text(`Dia: ${day} | Período: ${lecture.periodo}`, 14, 30);
                    const tableColumn = ["Nome", "Série", "Curso", "Período"];
                    const tableRows = (allRegistrations[uniqueId] || []).map(reg => [reg.name, `${reg.serie}ª Série`, reg.curso, reg.periodo]);
                    doc.autoTable({ head: [tableColumn], body: tableRows, startY: 40 });
                    doc.save(`inscritos-${lecture.title}-dia${day}.pdf`);
                }
            });
            document.addEventListener('submit', event => {
                if (event.target.matches('form[id^="form-"]')) handleRegistration(event);
            });
        }

        function init() {
            // Não renderiza nada até o período ser selecionado
            // A função handlePeriodoFilterClick agora é responsável por exibir o conteúdo
            setupEventListeners();
        }

        init();
    </script>
</body>
</html>